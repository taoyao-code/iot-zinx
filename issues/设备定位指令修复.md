# 设备定位指令修复

## 问题描述

设备没有收到发送的定位指令，无法执行声光定位功能。

## 根本原因

代码使用了错误的命令 ID 和缺少必需参数：

### 错误实现

```go
// ❌ 错误：使用查询参数命令
err := g.SendCommandToDevice(deviceID, constants.CmdQueryParam1, []byte{})
// CmdQueryParam1 = 0x90 // 查询运行参数1.1
```

### 协议要求

根据 `docs/协议/AP3000-设备与服务器通信协议.md`:

- **命令 ID**: 0x96 (声光寻找设备功能)
- **数据载荷**: 1 字节定位时间（单位：秒）
- **设备行为**: 收到后播放语音并闪灯

## 修复方案

### 修复内容

1. **命令 ID 修正**: `CmdQueryParam1(0x90)` → `CmdDeviceLocate(0x96)`
2. **添加参数**: 空载荷 → 30 秒定位时间
3. **日志优化**: 更新日志描述

### 修复代码

```go
// ✅ 正确：使用设备定位命令
locationDuration := byte(30)
err := g.SendCommandToDevice(deviceID, constants.CmdDeviceLocate, []byte{locationDuration})
```

## 修复文件

- `pkg/gateway/device_gateway.go` - SendLocationCommand 方法

## 验证方法

1. 发送定位命令到在线设备
2. 确认设备执行声光定位功能
3. 检查日志显示正确的命令 ID (0x96)

## 修复时间

2025 年 8 月 9 日

## 影响范围

- 修复后设备能正确接收并执行定位功能
- 不影响其他功能
- 向后兼容
