# 示例代码

本目录包含使用pkg包的示例代码。

## 示例文件

- `basic_usage.go`: 展示如何使用pkg包创建一个简单的TCP服务器，包含：
  - 初始化pkg包依赖关系
  - 设置连接钩子
  - 使用TCP监控器
  - 获取命令管理器

## 运行示例

```bash
# 运行基本示例
cd examples
go run basic_usage.go
```

## 编写新示例

添加新示例时，请遵循以下规则：

1. 每个示例都应该是一个完整的可运行程序
2. 包含详细的注释说明每个步骤的作用
3. 尽量展示一种典型的使用场景
4. 避免引入不必要的依赖

## 示例说明

### basic_usage.go

这个示例展示了如何使用pkg包中的核心功能创建一个简单的TCP服务器。它包含以下步骤：

1. 初始化pkg包依赖关系
2. 创建一个Zinx服务器
3. 注册连接钩子，用于处理连接建立和关闭事件
4. 设置TCP监控器，用于监控设备连接状态
5. 获取命令管理器，用于处理命令发送和确认
6. 启动服务器并等待退出信号

这个示例没有实现具体的业务逻辑，仅展示如何集成pkg包中的基础组件。

## 编译和运行

```bash
# 编译示例
go build -o basic_example examples/basic_usage.go

# 运行示例
./basic_example
```

## 使用说明

示例服务器监听在`0.0.0.0:8999`端口，支持DNY协议的设备可以连接到此端口进行通信。

示例中的路由处理器支持以下命令：
- `0x81`: 设备状态查询

服务器配置了30秒的心跳检测间隔，使用DNY协议的格式发送心跳消息。

## 测试方法

可以使用以下方法测试示例服务器：

1. 使用`telnet`或`netcat`连接到服务器：
   ```bash
   nc 127.0.0.1 8999
   ```

2. 发送DNY协议格式的数据，例如设备状态查询命令：
   ```
   # 十六进制格式
   444E59 0B00 01000000 0000 81 00 6E01
   ```

3. 查看服务器输出的日志，确认连接建立、数据收发和心跳机制正常工作。 