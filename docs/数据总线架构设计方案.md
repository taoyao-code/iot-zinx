# æ•°æ®æ€»çº¿æ¶æ„è®¾è®¡æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025 å¹´ 7 æœˆ 22 æ—¥  
**çŠ¶æ€**: å¼ºåˆ¶æ‰§è¡Œè¦æ±‚  
**é€‚ç”¨èŒƒå›´**: IoT-Zinx ç³»ç»Ÿé‡æ„

---

## ğŸ“‹ **æ–‡æ¡£è¯´æ˜**

æœ¬æ–‡æ¡£æ˜¯ IoT-Zinx ç³»ç»Ÿæ•°æ®ç®¡ç†é‡æ„çš„**å¼ºåˆ¶æ€§æŠ€æœ¯è§„èŒƒ**ï¼Œæ‰€æœ‰åç»­å¼€å‘ä»»åŠ¡å¿…é¡»ä¸¥æ ¼æŒ‰ç…§æœ¬æ–¹æ¡ˆæ‰§è¡Œã€‚

### **å¼ºåˆ¶è¦æ±‚**

- âœ… æ‰€æœ‰æ•°æ®è®¿é—®å¿…é¡»é€šè¿‡ DataBus æ¥å£
- âœ… ç¦æ­¢æ¨¡å—é—´ç›´æ¥æ•°æ®è®¿é—®
- âœ… å¿…é¡»ä½¿ç”¨æ ‡å‡†åŒ–æ•°æ®æ¨¡å‹
- âœ… å¿…é¡»å®ç°æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶
- âœ… å¿…é¡»æŒ‰ç…§æŒ‡å®šçš„æ•°æ®æµè½¬è§„åˆ™

---

## ğŸ¯ **é—®é¢˜å®šä¹‰**

### **å½“å‰æ•°æ®ç®¡ç†æ··ä¹±ç°çŠ¶**

#### **æ•°æ®é‡å¤å­˜å‚¨ä¸¥é‡**

åŒä¸€è®¾å¤‡æ•°æ®åœ¨ç³»ç»Ÿä¸­å­˜åœ¨**6 ç§ä¸åŒè¡¨ç¤º**ï¼š

- `DeviceSession` (pkg/session)
- `UnifiedDeviceSession` (pkg/core)
- `UnifiedSession` (pkg/session)
- `ConnectionInfo` (pkg/core)
- `ConnectionMetrics` (pkg/monitor)
- `DeviceRegistrationState` (handlers)

#### **çŠ¶æ€ç®¡ç†æ··ä¹±**

è®¾å¤‡çŠ¶æ€åœ¨**5 ä¸ªåœ°æ–¹**é‡å¤ç®¡ç†ï¼š

- `DeviceStatusManager.deviceStatus`
- `UnifiedStateManager.deviceStates`
- `DeviceSession.State/Status`
- `ConnectionMetrics.Status`
- `UnifiedSession.state`

#### **ä¸šåŠ¡æ•°æ®æµæ–­è£‚**

å……ç”µæµç¨‹æ•°æ®æ— æ³•ä¸²è”ï¼š

```
å……ç”µè¯·æ±‚ â†’ UnifiedChargingService (è®¢å•æ•°æ®)
è®¾å¤‡å“åº” â†’ PowerHeartbeatHandler (åŠŸç‡æ•°æ®)
å……ç”µç»“æŸ â†’ SettlementHandler (ç»“ç®—æ•°æ®)
å®¡è®¡è®°å½• â†’ ChargingAuditService (æ—¥å¿—æ•°æ®)
```

#### **æ•°æ®è½¬æ¢æ€§èƒ½æŸè€—**

æ¯æ¬¡æ•°æ®æµè½¬éœ€è¦å¤šæ¬¡è½¬æ¢ï¼š

- è®¾å¤‡ ID æ ¼å¼ï¼š`string` â†” `uint32` â†” `[]byte`
- ç«¯å£å·ï¼šAPI ç«¯å£(1-based) â†” åè®®ç«¯å£(0-based)
- æ—¶é—´æ ¼å¼ï¼š`time.Time` â†” Unix æ—¶é—´æˆ³ â†” å­—ç¬¦ä¸²

---

## ğŸ—ï¸ **æ•°æ®æ€»çº¿æ¶æ„è®¾è®¡**

### **æ ¸å¿ƒè®¾è®¡åŸåˆ™**

1. **å•ä¸€æ•°æ®æº** - æ¯ç§æ•°æ®åªæœ‰ä¸€ä¸ªæƒå¨æ¥æº
2. **æ•°æ®æ‰€æœ‰æƒæ˜ç¡®** - æ¯ä¸ªæ•°æ®æœ‰æ˜ç¡®çš„æ‰€æœ‰è€…æ¨¡å—
3. **æ ‡å‡†åŒ–æ•°æ®æ¥å£** - æ¨¡å—é—´é€šè¿‡æ ‡å‡†æ¥å£äº¤æ¢æ•°æ®
4. **æ•°æ®æµå¯è¿½è¸ª** - æ•°æ®çš„æµè½¬è·¯å¾„æ¸…æ™°å¯æ§
5. **æ¨¡å—ç‹¬ç«‹æ€§** - å„æ¨¡å—ä¿æŒç‹¬ç«‹ä½†æ•°æ®æµä¸€è‡´

### **1. æ•°æ®åˆ†ç±»å’Œæ‰€æœ‰æƒåˆ’åˆ†**

#### **è®¾å¤‡åŸºç¡€æ•°æ®åŸŸ** - `DeviceDataManager`ï¼ˆå”¯ä¸€æ‰€æœ‰è€…ï¼‰

```
è´Ÿè´£æ•°æ®ï¼š
â”œâ”€ è®¾å¤‡æ ‡è¯†ï¼šdeviceID, physicalID, ICCID
â”œâ”€ è®¾å¤‡å±æ€§ï¼šdeviceType, version, model
â”œâ”€ è¿æ¥ä¿¡æ¯ï¼šconnID, remoteAddr, connectedAt
â””â”€ è®¾å¤‡é…ç½®ï¼športCount, capabilities

ç»Ÿä¸€å‰åˆ†æ•£ä½ç½®ï¼š
â”œâ”€ DeviceSession (pkg/session)
â”œâ”€ UnifiedDeviceSession (pkg/core)
â”œâ”€ ConnectionInfo (pkg/core)
â””â”€ DeviceRegistrationState (handlers)

ç»Ÿä¸€åï¼šåªåœ¨ DeviceDataManager ä¸­å­˜å‚¨å’Œç®¡ç†
```

#### **è®¾å¤‡çŠ¶æ€æ•°æ®åŸŸ** - `DeviceStateManager`ï¼ˆå”¯ä¸€æ‰€æœ‰è€…ï¼‰

```
è´Ÿè´£æ•°æ®ï¼š
â”œâ”€ è¿æ¥çŠ¶æ€ï¼šconnected, disconnected, timeout
â”œâ”€ ä¸šåŠ¡çŠ¶æ€ï¼šonline, offline, charging, idle
â”œâ”€ å¥åº·çŠ¶æ€ï¼šnormal, warning, error
â””â”€ çŠ¶æ€å†å²ï¼šstateChanges, lastUpdate

ç»Ÿä¸€å‰åˆ†æ•£ä½ç½®ï¼š
â”œâ”€ DeviceStatusManager.deviceStatus
â”œâ”€ UnifiedStateManager.deviceStates
â”œâ”€ DeviceSession.State/Status
â”œâ”€ ConnectionMetrics.Status
â””â”€ UnifiedSession.state

ç»Ÿä¸€åï¼šåªåœ¨ DeviceStateManager ä¸­å­˜å‚¨å’Œç®¡ç†
```

#### **ç«¯å£æ•°æ®åŸŸ** - `PortDataManager`ï¼ˆå”¯ä¸€æ‰€æœ‰è€…ï¼‰

```
è´Ÿè´£æ•°æ®ï¼š
â”œâ”€ ç«¯å£çŠ¶æ€ï¼šidle, charging, fault, occupied
â”œâ”€ ç«¯å£é…ç½®ï¼šmaxPower, supportedModes
â”œâ”€ å®æ—¶æ•°æ®ï¼šcurrentPower, voltage, current
â”œâ”€ å……ç”µæ•°æ®ï¼šchargeDuration, totalEnergy
â””â”€ ç«¯å£æ˜ å°„ï¼šAPIç«¯å£ â†” åè®®ç«¯å£

ç»Ÿä¸€å‰åˆ†æ•£ä½ç½®ï¼š
â”œâ”€ PortManager.portStates
â”œâ”€ PowerHeartbeatHandlerä¸­çš„ä¸´æ—¶è§£æ
â”œâ”€ å„Handlerä¸­çš„ç«¯å£æ•°æ®
â””â”€ ChargingAuditServiceä¸­çš„ç«¯å£è®°å½•

ç»Ÿä¸€åï¼šåªåœ¨ PortDataManager ä¸­å­˜å‚¨å’Œç®¡ç†
```

#### **è®¢å•æ•°æ®åŸŸ** - `OrderDataManager`ï¼ˆå”¯ä¸€æ‰€æœ‰è€…ï¼‰

```
è´Ÿè´£æ•°æ®ï¼š
â”œâ”€ è®¢å•åŸºç¡€ï¼šorderID, deviceID, portNumber, userID
â”œâ”€ è®¢å•çŠ¶æ€ï¼šcreated, active, completed, failed
â”œâ”€ æ—¶é—´ä¿¡æ¯ï¼šstartTime, endTime, duration
â”œâ”€ è®¡è´¹æ•°æ®ï¼štotalEnergy, totalFee, chargeFee
â””â”€ ä¸šåŠ¡æ•°æ®ï¼šcardNumber, stopReason

ç»Ÿä¸€å‰åˆ†æ•£ä½ç½®ï¼š
â”œâ”€ UnifiedChargingServiceä¸­çš„è®¢å•ç®¡ç†
â”œâ”€ ChargingAuditServiceä¸­çš„å®¡è®¡è®°å½•
â”œâ”€ SettlementHandlerä¸­çš„ç»“ç®—æ•°æ®
â””â”€ å„ç§ä¸´æ—¶ç”Ÿæˆçš„è®¢å•å·

ç»Ÿä¸€åï¼šåªåœ¨ OrderDataManager ä¸­å­˜å‚¨å’Œç®¡ç†
```

#### **åè®®æ•°æ®åŸŸ** - `ProtocolDataManager`ï¼ˆå”¯ä¸€æ‰€æœ‰è€…ï¼‰

```
è´Ÿè´£æ•°æ®ï¼š
â”œâ”€ åŸå§‹æ•°æ®ï¼šrawBytes, timestamp, direction
â”œâ”€ è§£ææ•°æ®ï¼šcommand, messageID, payload
â”œâ”€ è½¬æ¢è§„åˆ™ï¼šåè®®æ ¼å¼ â†” ä¸šåŠ¡æ ¼å¼
â””â”€ æ¶ˆæ¯è·Ÿè¸ªï¼šrequestID, responseID, status

ç»Ÿä¸€å‰åˆ†æ•£ä½ç½®ï¼š
â”œâ”€ dny_protocol.Message
â”œâ”€ DecodedDNYFrame
â”œâ”€ å„Handlerä¸­çš„ä¸´æ—¶è§£æ
â””â”€ åè®®è½¬æ¢é€»è¾‘åˆ†æ•£å„å¤„

ç»Ÿä¸€åï¼šåªåœ¨ ProtocolDataManager ä¸­å­˜å‚¨å’Œç®¡ç†
```

### **2. æ•°æ®æ€»çº¿æ ¸å¿ƒæ¥å£è®¾è®¡**

#### **DataBus ä¸»æ¥å£**

```go
type DataBus interface {
    // === æ•°æ®å‘å¸ƒæ¥å£ ===
    PublishDeviceData(deviceID string, data *DeviceData) error
    PublishStateChange(deviceID string, oldState, newState DeviceState) error
    PublishPortData(deviceID string, portNum int, data *PortData) error
    PublishOrderData(orderID string, data *OrderData) error
    PublishProtocolData(connID uint64, data *ProtocolData) error

    // === æ•°æ®æŸ¥è¯¢æ¥å£ ===
    GetDeviceData(deviceID string) (*DeviceData, error)
    GetDeviceState(deviceID string) (DeviceState, error)
    GetPortData(deviceID string, portNum int) (*PortData, error)
    GetOrderData(orderID string) (*OrderData, error)
    GetActiveOrders(deviceID string) ([]*OrderData, error)

    // === æ•°æ®è®¢é˜…æ¥å£ ===
    SubscribeDeviceEvents(callback DeviceEventCallback) error
    SubscribeStateChanges(callback StateChangeCallback) error
    SubscribePortEvents(callback PortEventCallback) error
    SubscribeOrderEvents(callback OrderEventCallback) error

    // === æ‰¹é‡æ“ä½œæ¥å£ ===
    BatchUpdate(updates []DataUpdate) error
    Transaction(operations []DataOperation) error
}
```

#### **æ ‡å‡†åŒ–æ•°æ®æ¨¡å‹**

```go
// è®¾å¤‡æ•°æ®æ ‡å‡†æ¨¡å‹
type DeviceData struct {
    DeviceID     string            `json:"device_id"`
    PhysicalID   uint32            `json:"physical_id"`
    ICCID        string            `json:"iccid"`
    DeviceType   uint16            `json:"device_type"`
    Version      string            `json:"version"`
    ConnID       uint64            `json:"conn_id"`
    RemoteAddr   string            `json:"remote_addr"`
    ConnectedAt  time.Time         `json:"connected_at"`
    Properties   map[string]interface{} `json:"properties"`
}

// è®¾å¤‡çŠ¶æ€æ ‡å‡†æ¨¡å‹
type DeviceState struct {
    DeviceID        string    `json:"device_id"`
    ConnectionState string    `json:"connection_state"`
    BusinessState   string    `json:"business_state"`
    HealthState     string    `json:"health_state"`
    LastUpdate      time.Time `json:"last_update"`
    StateHistory    []StateChange `json:"state_history"`
}

// ç«¯å£æ•°æ®æ ‡å‡†æ¨¡å‹
type PortData struct {
    DeviceID      string    `json:"device_id"`
    PortNumber    int       `json:"port_number"`    // ç»Ÿä¸€ä½¿ç”¨APIç«¯å£å·(1-based)
    Status        string    `json:"status"`
    IsCharging    bool      `json:"is_charging"`
    CurrentPower  float64   `json:"current_power"`
    TotalEnergy   float64   `json:"total_energy"`
    ChargeDuration int64    `json:"charge_duration"`
    OrderID       string    `json:"order_id"`
    LastUpdate    time.Time `json:"last_update"`
}

// è®¢å•æ•°æ®æ ‡å‡†æ¨¡å‹
type OrderData struct {
    OrderID       string    `json:"order_id"`
    DeviceID      string    `json:"device_id"`
    PortNumber    int       `json:"port_number"`
    UserID        string    `json:"user_id"`
    Status        string    `json:"status"`
    StartTime     *time.Time `json:"start_time"`
    EndTime       *time.Time `json:"end_time"`
    TotalEnergy   float64   `json:"total_energy"`
    TotalFee      int64     `json:"total_fee"`
    CreatedAt     time.Time `json:"created_at"`
    UpdatedAt     time.Time `json:"updated_at"`
}
```

### **3. æ•°æ®æµæ§åˆ¶æœºåˆ¶**

#### **æ•°æ®æµå‘è§„åˆ™**

```
åè®®å±‚ â†’ ProtocolDataManager â†’ DataBus â†’ ä¸šåŠ¡å±‚
   â†“
Handlerå±‚ â†’ å¯¹åº”DataManager â†’ DataBus â†’ Serviceå±‚
   â†“
Serviceå±‚ â†’ å¯¹åº”DataManager â†’ DataBus â†’ å­˜å‚¨å±‚

å¼ºåˆ¶è§„åˆ™ï¼š
1. æ‰€æœ‰æ•°æ®å˜æ›´å¿…é¡»é€šè¿‡DataBus
2. æ¨¡å—ä¸èƒ½ç›´æ¥è®¿é—®å…¶ä»–æ¨¡å—çš„æ•°æ®å­˜å‚¨
3. æ•°æ®æŸ¥è¯¢é€šè¿‡DataBusçš„æ ‡å‡†æ¥å£
4. æ•°æ®å˜æ›´é€šè¿‡äº‹ä»¶é€šçŸ¥ç›¸å…³æ¨¡å—
```

#### **æ•°æ®ä¸€è‡´æ€§ä¿è¯**

```go
type DataConsistencyManager interface {
    // æ•°æ®éªŒè¯
    ValidateData(dataType string, data interface{}) error

    // æ•°æ®è½¬æ¢
    ConvertData(from, to string, data interface{}) (interface{}, error)

    // ä¸€è‡´æ€§æ£€æŸ¥
    CheckConsistency(dataType string, key string) error

    // æ•°æ®ä¿®å¤
    RepairInconsistency(dataType string, key string) error

    // äº‹åŠ¡æ”¯æŒ
    BeginTransaction() Transaction
    CommitTransaction(tx Transaction) error
    RollbackTransaction(tx Transaction) error
}
```

---

## ğŸ”„ **å®Œæ•´æ•°æ®æµè½¬è®¾è®¡**

### **1. è®¾å¤‡è¿æ¥æ³¨å†Œæµç¨‹**

#### **å½“å‰æ··ä¹±çš„æ•°æ®æµ**

```
TCPè¿æ¥ â†’ Zinx â†’ Handler â†’ ç›´æ¥æ›´æ–°6ä¸ªä¸åŒçš„æ•°æ®ç»“æ„ â†’ æ•°æ®ä¸ä¸€è‡´
```

#### **æ–°çš„ç»Ÿä¸€æ•°æ®æµ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TCPè¿æ¥å»ºç«‹  â”‚â”€â”€â”€â–¶â”‚ Zinxæ¡†æ¶æ¥æ”¶  â”‚â”€â”€â”€â–¶â”‚ è¿æ¥äº‹ä»¶è§¦å‘  â”‚â”€â”€â”€â–¶â”‚ ConnectionMgr â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚ å‘å¸ƒè¿æ¥äº‹ä»¶  â”‚â—€â”€â”€â”€â”‚ åˆ›å»ºè¿æ¥è®°å½•  â”‚â—€â”€â”€â”€â”‚              â”‚
â”‚ äº‹ä»¶åˆ†å‘ä¸­å¿ƒ  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceStateManager (æ›´æ–°è¿æ¥çŠ¶æ€: connected)
       â”œâ”€â”€â”€â”€â”€â–¶ MonitorManager (å¼€å§‹è¿æ¥ç›‘æ§)
       â””â”€â”€â”€â”€â”€â–¶ NotificationManager (å‘é€è¿æ¥é€šçŸ¥)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ICCIDæ•°æ®   â”‚â”€â”€â”€â–¶â”‚ProtocolDataMgrâ”‚â”€â”€â”€â–¶â”‚ è§£æICCID   â”‚
â”‚ åˆ°è¾¾        â”‚    â”‚ (åè®®è§£æ)    â”‚    â”‚ æ•°æ®        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚ å‘å¸ƒICCIDäº‹ä»¶ â”‚â—€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceDataManager (å…³è”ICCIDåˆ°è¿æ¥)
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceStateManager (æ›´æ–°çŠ¶æ€: awaiting_register)
       â””â”€â”€â”€â”€â”€â–¶ SessionManager (åˆ›å»ºä¸´æ—¶ä¼šè¯)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾å¤‡æ³¨å†Œæ•°æ® â”‚â”€â”€â”€â–¶â”‚ProtocolDataMgrâ”‚â”€â”€â”€â–¶â”‚ è§£ææ³¨å†Œæ•°æ® â”‚
â”‚ åˆ°è¾¾        â”‚    â”‚              â”‚    â”‚ (è®¾å¤‡ä¿¡æ¯)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚å‘å¸ƒè®¾å¤‡æ³¨å†Œäº‹ä»¶â”‚â—€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceDataManager (åˆ›å»ºå®Œæ•´è®¾å¤‡è®°å½•)
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceStateManager (æ›´æ–°çŠ¶æ€: registered)
       â”œâ”€â”€â”€â”€â”€â–¶ PortDataManager (åˆå§‹åŒ–ç«¯å£æ•°æ®)
       â”œâ”€â”€â”€â”€â”€â–¶ NotificationManager (å‘é€æ³¨å†ŒæˆåŠŸé€šçŸ¥)
       â””â”€â”€â”€â”€â”€â–¶ AuditManager (è®°å½•æ³¨å†Œæ—¥å¿—)
```

### **2. å……ç”µæ§åˆ¶æµç¨‹**

#### **å®Œæ•´çš„å……ç”µæ•°æ®æµè½¬**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTPå……ç”µè¯·æ±‚ â”‚â”€â”€â”€â–¶â”‚ ChargingAPI  â”‚â”€â”€â”€â–¶â”‚ è¯·æ±‚éªŒè¯å’Œ   â”‚
â”‚ (å¯åŠ¨å……ç”µ)   â”‚    â”‚              â”‚    â”‚ å‚æ•°è§£æ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚ æŸ¥è¯¢è®¾å¤‡çŠ¶æ€  â”‚â—€â”€â”€â”€â”‚ChargingServiceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                      â”‚
       â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DeviceDataMgrâ”‚                    â”‚PortDataMgr  â”‚
â”‚(è·å–è®¾å¤‡ä¿¡æ¯)â”‚                    â”‚(æ£€æŸ¥ç«¯å£çŠ¶æ€)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚ åˆ›å»ºå……ç”µè®¢å•  â”‚â—€â”€â”€â”€â”‚OrderDataMgr â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ PortDataManager (é¢„å ç«¯å£)
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceStateManager (æ›´æ–°è®¾å¤‡çŠ¶æ€: charging_requested)
       â””â”€â”€â”€â”€â”€â–¶ AuditManager (è®°å½•è®¢å•åˆ›å»º)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â”€â”€â”€â–¶â”‚ProtocolDataMgrâ”‚â”€â”€â”€â–¶â”‚ æ„å»ºå……ç”µåè®® â”‚
â”‚ è®¢å•åˆ›å»ºäº‹ä»¶ â”‚    â”‚              â”‚    â”‚ åŒ…å¹¶å‘é€    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾å¤‡å“åº”æ•°æ® â”‚â”€â”€â”€â–¶â”‚ProtocolDataMgrâ”‚â”€â”€â”€â–¶â”‚ è§£æå……ç”µå“åº” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚ å‘å¸ƒå“åº”äº‹ä»¶  â”‚â—€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ OrderDataManager (æ›´æ–°è®¢å•çŠ¶æ€: active)
       â”œâ”€â”€â”€â”€â”€â–¶ PortDataManager (æ›´æ–°ç«¯å£çŠ¶æ€: charging)
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceStateManager (æ›´æ–°è®¾å¤‡çŠ¶æ€: charging)
       â””â”€â”€â”€â”€â”€â–¶ NotificationManager (å‘é€å……ç”µå¼€å§‹é€šçŸ¥)
```

### **3. è®¾å¤‡æ•°æ®ä¸ŠæŠ¥æµç¨‹**

#### **åŠŸç‡å¿ƒè·³æ•°æ®æµè½¬**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾å¤‡åŠŸç‡æ•°æ® â”‚â”€â”€â”€â–¶â”‚ProtocolDataMgrâ”‚â”€â”€â”€â–¶â”‚ è§£æåŠŸç‡å¿ƒè·³ â”‚
â”‚ ä¸ŠæŠ¥        â”‚    â”‚              â”‚    â”‚ æ•°æ®        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚ å‘å¸ƒåŠŸç‡äº‹ä»¶  â”‚â—€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ PortDataManager (æ›´æ–°ç«¯å£å®æ—¶æ•°æ®)
       â”‚       â”œâ”€ å®æ—¶åŠŸç‡: 1500W
       â”‚       â”œâ”€ ç´¯è®¡ç”µé‡: 5.2kWh
       â”‚       â”œâ”€ å……ç”µæ—¶é•¿: 120åˆ†é’Ÿ
       â”‚       â””â”€ ç«¯å£çŠ¶æ€: charging
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ OrderDataManager (æ›´æ–°è®¢å•è¿›åº¦)
       â”‚       â”œâ”€ å½“å‰ç”µé‡: 5.2kWh
       â”‚       â”œâ”€ å……ç”µæ—¶é•¿: 120åˆ†é’Ÿ
       â”‚       â””â”€ è®¢å•çŠ¶æ€: active
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceStateManager (æ›´æ–°å¿ƒè·³æ—¶é—´)
       â”‚       â””â”€ æœ€åæ´»åŠ¨æ—¶é—´: 2025-07-22 10:30:00
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ MonitorManager (æ›´æ–°ç›‘æ§æŒ‡æ ‡)
       â”‚       â”œâ”€ è¿æ¥å¥åº·åº¦: 100%
       â”‚       â””â”€ æ•°æ®ä¸ŠæŠ¥é¢‘ç‡: æ­£å¸¸
       â”‚
       â””â”€â”€â”€â”€â”€â–¶ NotificationManager (å®æ—¶æ•°æ®æ¨é€)
               â””â”€ æ¨é€ç»™ç¬¬ä¸‰æ–¹å¹³å°å’Œå‰ç«¯
```

#### **ç»“ç®—æ•°æ®æµè½¬**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾å¤‡ç»“ç®—æ•°æ® â”‚â”€â”€â”€â–¶â”‚ProtocolDataMgrâ”‚â”€â”€â”€â–¶â”‚ è§£æç»“ç®—æ•°æ® â”‚
â”‚ ä¸ŠæŠ¥        â”‚    â”‚              â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚ å‘å¸ƒç»“ç®—äº‹ä»¶  â”‚â—€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ OrderDataManager (å®Œæˆè®¢å•)
       â”‚       â”œâ”€ è®¢å•çŠ¶æ€: completed
       â”‚       â”œâ”€ ç»“æŸæ—¶é—´: 2025-07-22 12:30:00
       â”‚       â”œâ”€ æ€»ç”µé‡: 8.5kWh
       â”‚       â”œâ”€ æ€»è´¹ç”¨: 42.50å…ƒ
       â”‚       â””â”€ ç»“ç®—åŸå› : ç”¨æˆ·ä¸»åŠ¨åœæ­¢
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ PortDataManager (é‡Šæ”¾ç«¯å£)
       â”‚       â”œâ”€ ç«¯å£çŠ¶æ€: idle
       â”‚       â”œâ”€ æ¸…ç©ºè®¢å•å…³è”
       â”‚       â””â”€ é‡ç½®å®æ—¶æ•°æ®
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ DeviceStateManager (æ›´æ–°è®¾å¤‡çŠ¶æ€)
       â”‚       â””â”€ è®¾å¤‡çŠ¶æ€: online (ä»chargingå›åˆ°online)
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ BillingManager (å¤„ç†è®¡è´¹)
       â”‚       â”œâ”€ ç”Ÿæˆè´¦å•
       â”‚       â”œâ”€ æ›´æ–°ç”¨æˆ·ä½™é¢
       â”‚       â””â”€ è®°å½•äº¤æ˜“æµæ°´
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ NotificationManager (å‘é€ç»“ç®—é€šçŸ¥)
       â”‚       â”œâ”€ ç”¨æˆ·ç»“ç®—é€šçŸ¥
       â”‚       â”œâ”€ ç¬¬ä¸‰æ–¹å¹³å°é€šçŸ¥
       â”‚       â””â”€ è¿è¥åå°é€šçŸ¥
       â”‚
       â””â”€â”€â”€â”€â”€â–¶ AuditManager (è®°å½•å®¡è®¡æ—¥å¿—)
               â”œâ”€ å……ç”µå®Œæˆæ—¥å¿—
               â”œâ”€ ç»“ç®—è¯¦æƒ…æ—¥å¿—
               â””â”€ ä¸šåŠ¡æ“ä½œæ—¥å¿—
```

### **4. æ•°æ®å­˜å‚¨å±‚æµè½¬**

#### **å¤šçº§å­˜å‚¨çš„æ•°æ®æµè½¬**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸šåŠ¡æ•°æ®å˜æ›´ â”‚â”€â”€â”€â–¶â”‚ DataManager  â”‚â”€â”€â”€â–¶â”‚   DataBus   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    StorageManager                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ L1: å†…å­˜ç¼“å­˜ â”‚â”€â”€â”€â–¶â”‚ L2: Redisç¼“å­˜ â”‚â”€â”€â”€â–¶â”‚ L3: æ•°æ®åº“   â”‚        â”‚
â”‚  â”‚ (å®æ—¶æ•°æ®)   â”‚    â”‚ (çƒ­æ•°æ®)      â”‚    â”‚ (æŒä¹…åŒ–)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                   â”‚                   â”‚              â”‚
â”‚         â–¼                   â–¼                   â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ è®¾å¤‡çŠ¶æ€     â”‚    â”‚ ä¼šè¯æ•°æ®      â”‚    â”‚ å†å²è®°å½•    â”‚        â”‚
â”‚  â”‚ ç«¯å£æ•°æ®     â”‚    â”‚ è®¢å•æ•°æ®      â”‚    â”‚ ç»Ÿè®¡æ•°æ®    â”‚        â”‚
â”‚  â”‚ å®æ—¶æŒ‡æ ‡     â”‚    â”‚ é…ç½®ä¿¡æ¯      â”‚    â”‚ å®¡è®¡æ—¥å¿—    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®ä¸€è‡´æ€§   â”‚â—€â”€â”€â”€â”‚ å®šæœŸåŒæ­¥æ£€æŸ¥  â”‚â—€â”€â”€â”€â”‚ åå°ä»»åŠ¡     â”‚
â”‚ æ£€æŸ¥å’Œä¿®å¤   â”‚    â”‚              â”‚    â”‚ è°ƒåº¦å™¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **æ•°æ®æŸ¥è¯¢æµè½¬**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŸ¥è¯¢è¯·æ±‚     â”‚â”€â”€â”€â–¶â”‚   DataBus    â”‚â”€â”€â”€â–¶â”‚ è·¯ç”±åˆ°å¯¹åº”   â”‚
â”‚ (è®¾å¤‡çŠ¶æ€)   â”‚    â”‚              â”‚    â”‚ DataManager â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æŸ¥è¯¢ä¼˜åŒ–æµç¨‹                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ L1ç¼“å­˜æŸ¥è¯¢   â”‚â”€â”€â”€â–¶â”‚ ç¼“å­˜å‘½ä¸­?     â”‚â”€â”€â”€â–¶â”‚ è¿”å›æ•°æ®     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                   â”‚                                  â”‚
â”‚         â–¼                   â–¼ (æœªå‘½ä¸­)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ L2ç¼“å­˜æŸ¥è¯¢   â”‚â”€â”€â”€â–¶â”‚ ç¼“å­˜å‘½ä¸­?     â”‚â”€â”€â”€â–¶â”‚ æ›´æ–°L1å¹¶è¿”å› â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                   â”‚                                  â”‚
â”‚         â–¼                   â–¼ (æœªå‘½ä¸­)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ L3æ•°æ®åº“æŸ¥è¯¢ â”‚â”€â”€â”€â–¶â”‚ æŸ¥è¯¢ç»“æœ      â”‚â”€â”€â”€â–¶â”‚ æ›´æ–°L1,L2   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **5. å¼‚å¸¸å¤„ç†å’Œæ•°æ®æ¢å¤æµè½¬**

#### **æ•°æ®ä¸ä¸€è‡´æ£€æµ‹å’Œä¿®å¤**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®šæœŸä¸€è‡´æ€§   â”‚â”€â”€â”€â–¶â”‚ æ•°æ®æ¯”å¯¹æ£€æŸ¥  â”‚â”€â”€â”€â–¶â”‚ å‘ç°ä¸ä¸€è‡´   â”‚
â”‚ æ£€æŸ¥ä»»åŠ¡     â”‚    â”‚              â”‚    â”‚ æ•°æ®        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataBus   â”‚â—€â”€â”€â”€â”‚ è§¦å‘ä¿®å¤äº‹ä»¶  â”‚â—€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–¶ ç¡®å®šæƒå¨æ•°æ®æº (é€šå¸¸æ˜¯æ•°æ®åº“)
       â”œâ”€â”€â”€â”€â”€â–¶ ä»æƒå¨æºè·å–æ­£ç¡®æ•°æ®
       â”œâ”€â”€â”€â”€â”€â–¶ æ›´æ–°æ‰€æœ‰ç¼“å­˜å±‚
       â”œâ”€â”€â”€â”€â”€â–¶ é€šçŸ¥ç›¸å…³æ¨¡å—æ•°æ®å·²ä¿®å¤
       â””â”€â”€â”€â”€â”€â–¶ è®°å½•ä¿®å¤æ—¥å¿—

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»Ÿå¯åŠ¨æ—¶   â”‚â”€â”€â”€â–¶â”‚ æ•°æ®å®Œæ•´æ€§    â”‚â”€â”€â”€â–¶â”‚ æ¸…ç†æ— æ•ˆæ•°æ® â”‚
â”‚ æ•°æ®æ¢å¤     â”‚    â”‚ æ£€æŸ¥         â”‚    â”‚ å’Œä¼šè¯      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **6. äº‹ä»¶é©±åŠ¨çš„æ•°æ®æµè½¬æ¨¡å¼**

#### **æ ¸å¿ƒäº‹ä»¶ç±»å‹å’Œæµè½¬**

```
è®¾å¤‡äº‹ä»¶æµ:
DeviceConnected â†’ DeviceRegistered â†’ DeviceOnline â†’ DeviceCharging â†’ DeviceIdle â†’ DeviceOffline â†’ DeviceDisconnected

è®¢å•äº‹ä»¶æµ:
OrderCreated â†’ OrderActivated â†’ OrderInProgress â†’ OrderCompleted/OrderFailed â†’ OrderSettled

ç«¯å£äº‹ä»¶æµ:
PortIdle â†’ PortReserved â†’ PortCharging â†’ PortCompleted â†’ PortIdle

çŠ¶æ€äº‹ä»¶æµ:
StateChanged â†’ StateValidated â†’ StatePersisted â†’ StateNotified

æ¯ä¸ªäº‹ä»¶éƒ½é€šè¿‡DataBusåˆ†å‘ç»™æ‰€æœ‰è®¢é˜…è€…ï¼Œç¡®ä¿æ•°æ®æµè½¬çš„åŠæ—¶æ€§å’Œä¸€è‡´æ€§ã€‚
```

### **7. å…³é”®æ•°æ®æµè½¬åŸåˆ™**

1. **å•å‘æ•°æ®æµ**: æ•°æ®åªèƒ½ä»æ‰€æœ‰è€…æµå‘æ¶ˆè´¹è€…
2. **äº‹ä»¶é©±åŠ¨**: æ‰€æœ‰æ•°æ®å˜æ›´éƒ½é€šè¿‡äº‹ä»¶ä¼ æ’­
3. **æœ€ç»ˆä¸€è‡´æ€§**: é€šè¿‡å¼‚æ­¥å¤„ç†ä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´
4. **æ•…éšœæ¢å¤**: å…·å¤‡å®Œæ•´çš„æ•°æ®ä¿®å¤å’Œæ¢å¤èƒ½åŠ›
5. **å¯è¿½æº¯æ€§**: æ‰€æœ‰æ•°æ®å˜æ›´éƒ½æœ‰å®Œæ•´çš„å®¡è®¡è½¨è¿¹

---

## ğŸ¯ **ä¼˜åŠ¿ä¸åŠ£åŠ¿åˆ†æ**

### **ä¼˜åŠ¿**

#### **æ•°æ®ç®¡ç†ä¼˜åŠ¿**

- âœ… **æ¶ˆé™¤æ•°æ®é‡å¤**: å†…å­˜ä½¿ç”¨å‡å°‘ 60-80%ï¼Œæ•°æ®ä¸ä¸€è‡´é—®é¢˜å®Œå…¨æ¶ˆé™¤
- âœ… **ç»Ÿä¸€æ•°æ®è®¿é—®**: API å“åº”æ—¶é—´å‡å°‘ 50%ï¼Œå¼€å‘æ•ˆç‡æ˜¾è‘—æå‡
- âœ… **å¼ºä¸€è‡´æ€§ä¿è¯**: ä¸šåŠ¡é€»è¾‘é”™è¯¯å‡å°‘ 90%ï¼Œè¿è¥æ•°æ®å¯ä¿¡åº¦æå‡

#### **ç³»ç»Ÿæ¶æ„ä¼˜åŠ¿**

- âœ… **æ¨¡å—å®Œå…¨è§£è€¦**: å•ä¸ªæ¨¡å—å¯ç‹¬ç«‹å¼€å‘æµ‹è¯•ï¼Œä»£ç ç»´æŠ¤æˆæœ¬é™ä½ 40%
- âœ… **é«˜å¯æ‰©å±•æ€§**: æ–°åŠŸèƒ½å¼€å‘å‘¨æœŸç¼©çŸ­ 50%ï¼Œæ”¯æŒçƒ­æ’æ‹”æ¨¡å—
- âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†**: ç³»ç»Ÿç¨³å®šæ€§æå‡ï¼Œæ•…éšœæ¢å¤æ—¶é—´å‡å°‘ 80%

#### **æ€§èƒ½ä¼˜åŠ¿**

- âœ… **å‡å°‘è½¬æ¢å¼€é”€**: CPU ä½¿ç”¨ç‡é™ä½ 30%ï¼Œå†…å­˜åˆ†é…å‡å°‘ 50%
- âœ… **å¤šçº§ç¼“å­˜ä¼˜åŒ–**: ç¼“å­˜å‘½ä¸­ç‡ä» 60%æå‡åˆ° 90%ï¼Œå“åº”æ—¶é—´æå‡ 3-5 å€
- âœ… **æ‰¹é‡æ“ä½œæ”¯æŒ**: æ‰¹é‡æ›´æ–°æ€§èƒ½æå‡ 10 å€ï¼Œæ•°æ®åº“è¿æ¥æ•°å‡å°‘

### **åŠ£åŠ¿**

#### **å¤æ‚æ€§åŠ£åŠ¿**

- âŒ **æ¶æ„å¤æ‚åº¦å¢åŠ **: æ–°å¼€å‘è€…å­¦ä¹ æˆæœ¬é«˜ï¼Œéœ€è¦é¢å¤–ç›‘æ§å·¥å…·
- âŒ **äº‹ä»¶é©±åŠ¨å¤æ‚æ€§**: å¼‚æ­¥äº‹ä»¶å¤„ç†å¢åŠ ç³»ç»Ÿå¤æ‚æ€§ï¼Œè°ƒè¯•å›°éš¾
- âŒ **ä¸€è‡´æ€§ç®—æ³•å¤æ‚**: éœ€è¦å¤„ç†åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ï¼ŒæŠ€æœ¯è¦æ±‚é«˜

#### **æ€§èƒ½åŠ£åŠ¿**

- âŒ **é¢å¤–ç½‘ç»œå¼€é”€**: å»¶è¿Ÿå¢åŠ  10-20msï¼Œç½‘ç»œå¸¦å®½æ¶ˆè€—å¢åŠ 
- âŒ **å•ç‚¹æ•…éšœé£é™©**: DataBus æˆä¸ºå…³é”®ä¾èµ–ï¼Œéœ€è¦é«˜å¯ç”¨éƒ¨ç½²
- âŒ **èµ„æºå¼€é”€**: å†…å­˜ä½¿ç”¨å¢åŠ  20-30%ï¼ŒCPU ä½¿ç”¨å¢åŠ  15-25%

#### **å®æ–½åŠ£åŠ¿**

- âŒ **è¿ç§»æˆæœ¬é«˜**: éœ€è¦ 3-6 ä¸ªæœˆå¼€å‘æ—¶é—´ï¼Œè¿ç§»æœŸé—´ç³»ç»Ÿä¸ç¨³å®š
- âŒ **æŠ€èƒ½è¦æ±‚é«˜**: éœ€è¦åˆ†å¸ƒå¼ç³»ç»Ÿå’Œäº‹ä»¶é©±åŠ¨æ¶æ„ç»éªŒ
- âŒ **æµ‹è¯•å¤æ‚**: å¼‚æ­¥äº‹ä»¶å’Œåˆ†å¸ƒå¼æ•°æ®å¢åŠ æµ‹è¯•éš¾åº¦

#### **è¿ç»´åŠ£åŠ¿**

- âŒ **ç›‘æ§å¤æ‚**: ç›‘æ§æŒ‡æ ‡æ•°é‡å¢åŠ  3-5 å€ï¼Œéœ€è¦ä¸“ä¸šç›‘æ§å·¥å…·
- âŒ **æ•…éšœæ’æŸ¥å›°éš¾**: åˆ†å¸ƒå¼ç³»ç»Ÿæ•…éšœæ’æŸ¥å¤æ‚ï¼Œéœ€è¦ä¸“ä¸šå·¥å…·

---

## ğŸ“‹ **å®æ–½é˜¶æ®µè§„åˆ’**

### **é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½å»ºè®¾ï¼ˆ2-3 å‘¨ï¼‰**

#### **ä»»åŠ¡æ¸…å•**

```
â”œâ”€ è®¾è®¡å’Œå®ç° DataBus æ ¸å¿ƒæ¥å£
â”œâ”€ å®ç°æ ‡å‡†åŒ–æ•°æ®æ¨¡å‹
â”œâ”€ å®ç°æ•°æ®ä¸€è‡´æ€§ç®¡ç†å™¨
â”œâ”€ å»ºç«‹æ•°æ®å­˜å‚¨æŠ½è±¡å±‚
â””â”€ ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
```

#### **äº¤ä»˜ç‰©**

```
â”œâ”€ DataBus æ¥å£å®ç°
â”œâ”€ æ ‡å‡†æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€ å­˜å‚¨å±‚æŠ½è±¡å®ç°
â””â”€ æµ‹è¯•ç”¨ä¾‹å’Œæ–‡æ¡£
```

### **é˜¶æ®µ 2ï¼šæ•°æ®ç®¡ç†å™¨é‡æ„ï¼ˆ3-4 å‘¨ï¼‰**

#### **ä»»åŠ¡æ¸…å•**

```
â”œâ”€ å®ç° DeviceDataManager
â”œâ”€ å®ç° DeviceStateManager
â”œâ”€ å®ç° PortDataManager
â”œâ”€ å®ç° OrderDataManager
â”œâ”€ å®ç° ProtocolDataManager
â””â”€ é›†æˆåˆ° DataBus ä¸­
```

#### **äº¤ä»˜ç‰©**

```
â”œâ”€ 5ä¸ªæ•°æ®ç®¡ç†å™¨å®ç°
â”œâ”€ DataBus é›†æˆå®Œæˆ
â”œâ”€ æ•°æ®è¿ç§»å·¥å…·
â””â”€ æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
```

### **é˜¶æ®µ 3ï¼šæ¨¡å—é€æ­¥æ”¹é€ ï¼ˆ4-5 å‘¨ï¼‰**

#### **ä¼˜å…ˆçº§é¡ºåº**

```
1. åè®®å¤„ç†å±‚ (Handler)
2. ä¸šåŠ¡æœåŠ¡å±‚ (Service)
3. ç›‘æ§ç®¡ç†å±‚ (Monitor)
4. é€šçŸ¥ç³»ç»Ÿå±‚ (Notification)
5. HTTPæ¥å£å±‚ (API)
```

#### **æ¯ä¸ªæ¨¡å—æ”¹é€ æ­¥éª¤**

```
â”œâ”€ ç§»é™¤ç›´æ¥æ•°æ®è®¿é—®ä»£ç 
â”œâ”€ æ”¹ç”¨ DataBus æ¥å£
â”œâ”€ æ·»åŠ æ•°æ®äº‹ä»¶ç›‘å¬
â”œâ”€ éªŒè¯æ•°æ®ä¸€è‡´æ€§
â””â”€ æ€§èƒ½å’ŒåŠŸèƒ½æµ‹è¯•
```

### **é˜¶æ®µ 4ï¼šæ•°æ®æ¸…ç†å’Œä¼˜åŒ–ï¼ˆ2-3 å‘¨ï¼‰**

#### **ä»»åŠ¡æ¸…å•**

```
â”œâ”€ æ¸…ç†é‡å¤çš„æ•°æ®å­˜å‚¨ä»£ç 
â”œâ”€ ç§»é™¤åºŸå¼ƒçš„ç®¡ç†å™¨å’Œæ¥å£
â”œâ”€ æ•°æ®ä¸€è‡´æ€§éªŒè¯å’Œä¿®å¤
â”œâ”€ æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§
â””â”€ æ–‡æ¡£æ›´æ–°å’ŒåŸ¹è®­
```

#### **äº¤ä»˜ç‰©**

```
â”œâ”€ æ¸…ç†åçš„ä»£ç åº“
â”œâ”€ æ•°æ®ä¸€è‡´æ€§æŠ¥å‘Š
â”œâ”€ æ€§èƒ½ä¼˜åŒ–æŠ¥å‘Š
â””â”€ æ–°æ¶æ„æ–‡æ¡£
```

---

## âš ï¸ **å¼ºåˆ¶æ‰§è¡Œè¦æ±‚**

### **å¼€å‘è§„èŒƒ**

#### **æ•°æ®è®¿é—®è§„èŒƒ**

```go
// âœ… æ­£ç¡®çš„æ•°æ®è®¿é—®æ–¹å¼
func (h *DeviceRegisterHandler) Handle(request *Request) error {
    // é€šè¿‡DataBusè·å–æ•°æ®
    deviceData, err := h.dataBus.GetDeviceData(deviceID)
    if err != nil {
        return err
    }

    // é€šè¿‡DataBuså‘å¸ƒæ•°æ®å˜æ›´
    return h.dataBus.PublishDeviceData(deviceID, newDeviceData)
}

// âŒ ç¦æ­¢çš„æ•°æ®è®¿é—®æ–¹å¼
func (h *DeviceRegisterHandler) Handle(request *Request) error {
    // ç¦æ­¢ç›´æ¥è®¿é—®å…¶ä»–æ¨¡å—çš„æ•°æ®
    session := h.sessionManager.GetSession(deviceID)  // âŒ ç¦æ­¢
    h.deviceStatusManager.UpdateStatus(deviceID, status)  // âŒ ç¦æ­¢
    return nil
}
```

#### **æ•°æ®æ¨¡å‹è§„èŒƒ**

```go
// âœ… å¿…é¡»ä½¿ç”¨æ ‡å‡†åŒ–æ•°æ®æ¨¡å‹
type DeviceData struct {
    DeviceID     string            `json:"device_id"`
    PhysicalID   uint32            `json:"physical_id"`
    ICCID        string            `json:"iccid"`
    // ... å…¶ä»–æ ‡å‡†å­—æ®µ
}

// âŒ ç¦æ­¢ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ç»“æ„
type CustomDeviceInfo struct {  // âŒ ç¦æ­¢
    ID   string
    Info map[string]interface{}
}
```

#### **äº‹ä»¶å¤„ç†è§„èŒƒ**

```go
// âœ… æ­£ç¡®çš„äº‹ä»¶å¤„ç†æ–¹å¼
func (s *ChargingService) onOrderCreated(event OrderEvent) {
    // ç›‘å¬è®¢å•åˆ›å»ºäº‹ä»¶
    if event.Type == OrderCreated {
        // å¤„ç†ä¸šåŠ¡é€»è¾‘
        s.processNewOrder(event.OrderData)
    }
}

// âŒ ç¦æ­¢çš„ç›´æ¥è°ƒç”¨æ–¹å¼
func (s *ChargingService) createOrder(orderData *OrderData) {
    // ç¦æ­¢ç›´æ¥è°ƒç”¨å…¶ä»–æœåŠ¡
    s.portManager.ReservePort(orderData.PortNumber)  // âŒ ç¦æ­¢
}
```

### **ä»£ç å®¡æŸ¥è¦æ±‚**

#### **å¿…é¡»æ£€æŸ¥é¡¹**

- [ ] æ˜¯å¦é€šè¿‡ DataBus è®¿é—®æ•°æ®
- [ ] æ˜¯å¦ä½¿ç”¨æ ‡å‡†åŒ–æ•°æ®æ¨¡å‹
- [ ] æ˜¯å¦æ­£ç¡®å¤„ç†äº‹ä»¶è®¢é˜…
- [ ] æ˜¯å¦é¿å…ç›´æ¥æ¨¡å—é—´è°ƒç”¨
- [ ] æ˜¯å¦å®ç°é”™è¯¯å¤„ç†å’Œå›æ»š

#### **æ€§èƒ½è¦æ±‚**

- [ ] æ•°æ®æŸ¥è¯¢å“åº”æ—¶é—´ < 100ms
- [ ] äº‹ä»¶å¤„ç†å»¶è¿Ÿ < 50ms
- [ ] å†…å­˜ä½¿ç”¨å¢é•¿ < 30%
- [ ] CPU ä½¿ç”¨å¢é•¿ < 25%

#### **æµ‹è¯•è¦æ±‚**

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] é›†æˆæµ‹è¯•è¦†ç›–æ ¸å¿ƒæµç¨‹
- [ ] æ€§èƒ½æµ‹è¯•éªŒè¯æŒ‡æ ‡
- [ ] æ•°æ®ä¸€è‡´æ€§æµ‹è¯•

---

## ğŸ“Š **ç›‘æ§å’Œåº¦é‡æŒ‡æ ‡**

### **æ•°æ®ä¸€è‡´æ€§æŒ‡æ ‡**

```
â”œâ”€ æ•°æ®ä¸ä¸€è‡´æ£€æµ‹æ¬¡æ•°/å¤©
â”œâ”€ æ•°æ®ä¿®å¤æˆåŠŸç‡
â”œâ”€ æ•°æ®åŒæ­¥å»¶è¿Ÿ
â””â”€ ç¼“å­˜å‘½ä¸­ç‡
```

### **æ€§èƒ½æŒ‡æ ‡**

```
â”œâ”€ DataBuså“åº”æ—¶é—´
â”œâ”€ äº‹ä»¶å¤„ç†å»¶è¿Ÿ
â”œâ”€ å†…å­˜ä½¿ç”¨é‡
â”œâ”€ CPUä½¿ç”¨ç‡
â””â”€ ç½‘ç»œIOé‡
```

### **ä¸šåŠ¡æŒ‡æ ‡**

```
â”œâ”€ è®¾å¤‡æ³¨å†ŒæˆåŠŸç‡
â”œâ”€ å……ç”µè®¢å•å®Œæˆç‡
â”œâ”€ æ•°æ®ä¸ŠæŠ¥åŠæ—¶æ€§
â””â”€ ç¬¬ä¸‰æ–¹é€šçŸ¥æˆåŠŸç‡
```

---

## ğŸ¯ **ç»“è®º**

æœ¬æ•°æ®æ€»çº¿æ¶æ„è®¾è®¡æ–¹æ¡ˆæ˜¯è§£å†³å½“å‰ IoT-Zinx ç³»ç»Ÿæ•°æ®ç®¡ç†æ··ä¹±é—®é¢˜çš„**å¼ºåˆ¶æ€§æŠ€æœ¯è§„èŒƒ**ã€‚

### **æ ¸å¿ƒä»·å€¼**

1. **å½»åº•è§£å†³æ•°æ®é‡å¤å’Œä¸ä¸€è‡´é—®é¢˜**
2. **å®ç°çœŸæ­£çš„æ¨¡å—ç‹¬ç«‹å’Œè§£è€¦**
3. **å»ºç«‹å¯æ‰©å±•çš„æ•°æ®ç®¡ç†æ¶æ„**
4. **æä¾›ç»Ÿä¸€çš„æ•°æ®è®¿é—®å’Œå¤„ç†æœºåˆ¶**

### **å®æ–½è¦æ±‚**

- **å¼ºåˆ¶æ‰§è¡Œ**: æ‰€æœ‰åç»­å¼€å‘å¿…é¡»éµå¾ªæœ¬æ–¹æ¡ˆ
- **åˆ†é˜¶æ®µå®æ–½**: æŒ‰ç…§ 4 ä¸ªé˜¶æ®µé€æ­¥æ¨è¿›
- **ä¸¥æ ¼æµ‹è¯•**: æ¯ä¸ªé˜¶æ®µéƒ½è¦é€šè¿‡å®Œæ•´æµ‹è¯•
- **æŒç»­ç›‘æ§**: å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œåº¦é‡ä½“ç³»

### **æˆåŠŸæ ‡å‡†**

- âœ… æ•°æ®é‡å¤å­˜å‚¨å®Œå…¨æ¶ˆé™¤
- âœ… æ•°æ®ä¸€è‡´æ€§é—®é¢˜å®Œå…¨è§£å†³
- âœ… æ¨¡å—é—´è€¦åˆåº¦æ˜¾è‘—é™ä½
- âœ… ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§æå‡
- âœ… å¼€å‘å’Œç»´æŠ¤æ•ˆç‡æé«˜

**æœ¬æ–¹æ¡ˆä¸€ç»ç¡®å®šï¼Œå³ä¸ºåç»­æ‰€æœ‰å¼€å‘ä»»åŠ¡çš„å¼ºåˆ¶æ€§æŠ€æœ¯è¦æ±‚ï¼Œä¸å¾—éšæ„æ›´æ”¹æˆ–è¿åã€‚**
