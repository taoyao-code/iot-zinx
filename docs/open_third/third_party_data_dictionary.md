# IoT-Zinx 第三方平台对接数据字典

## 数据字典概述

本文档详细定义了IoT-Zinx系统推送给第三方平台的所有数据字段，包括字段含义、数据类型、取值范围、单位等信息。

## 通用字段定义

### 基础事件字段

| 字段名 | 数据类型 | 必填 | 说明 | 示例值 |
|--------|----------|------|------|--------|
| event_id | string | 是 | 事件唯一标识符，UUID格式 | "550e8400-e29b-41d4-a716-446655440000" |
| event_type | string | 是 | 事件类型，见事件类型枚举 | "device_online" |
| device_id | string | 是 | 设备ID，8位十六进制字符串 | "04A228CD" |
| port_number | integer | 否 | 端口号，1-based，范围1-255 | 1 |
| timestamp | integer | 是 | 事件时间戳，Unix时间戳（秒） | 1703123456 |
| data | object | 是 | 事件具体数据，结构因事件类型而异 | {} |

### 连接信息字段

| 字段名 | 数据类型 | 说明 | 示例值 |
|--------|----------|------|--------|
| conn_id | integer | TCP连接ID，系统内部标识 | 12345 |
| remote_addr | string | 设备IP地址和端口 | "192.168.1.100:54321" |
| connect_time | integer | 连接建立时间戳 | 1703123456 |
| message_id | string | 协议消息ID，十六进制格式 | "0x1234" |
| command | string | 协议指令码，十六进制格式 | "0x20" |

## 设备相关字段

### 设备基础信息

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| physical_id | string | 物理ID十六进制格式 | 8位十六进制 | "0x04A228CD" |
| physical_id_decimal | integer | 物理ID十进制格式 | 0-4294967295 | 77915341 |
| device_type | integer | 设备类型 | 1=充电桩, 2=其他 | 1 |
| device_version | string | 设备版本号 | 格式：Vx.x.x | "V2.1.0" |
| firmware_version | string | 固件版本号 | 格式：Vx.x.x | "V2.1.0" |
| iccid | string | SIM卡ICCID号码 | 20位数字 | "89860318123456789012" |
| heartbeat_period | integer | 心跳周期（秒） | 10-300 | 30 |

### 设备状态信息

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| voltage | float | 电压值（伏特） | 0-500.0 | 220.5 |
| signal_strength | integer | 信号强度百分比 | 0-100 | 85 |
| temperature | integer | 环境温度（摄氏度） | -40-80 | 25 |
| port_count | integer | 端口总数 | 1-255 | 10 |

### 离线相关字段

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| offline_reason | string | 离线原因 | 见离线原因枚举 | "heartbeat_timeout" |
| last_heartbeat_time | integer | 最后心跳时间戳 | Unix时间戳 | 1703123400 |
| offline_duration | integer | 离线时长（秒） | 0-86400 | 56 |
| connection_duration | integer | 连接持续时长（秒） | 0-无限制 | 3600 |

## 端口相关字段

### 端口状态信息

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| port_status | integer | 端口状态码 | 0x00-0x0F | 1 |
| port_status_desc | string | 端口状态描述 | 见端口状态枚举 | "充电中" |
| previous_status | integer | 前一个状态码 | 0x00-0x0F | 0 |
| previous_status_desc | string | 前一个状态描述 | 见端口状态枚举 | "空闲" |
| is_charging | boolean | 是否正在充电 | true/false | true |
| status_change_time | integer | 状态变化时间戳 | Unix时间戳 | 1703123456 |
| fault_detected | boolean | 是否检测到故障 | true/false | false |

### 端口状态数组

| 字段名 | 数据类型 | 说明 | 示例值 |
|--------|----------|------|--------|
| port_statuses | array | 端口状态数组 | [{"port": 1, "status": 1, "status_desc": "充电中"}] |

**port_statuses数组元素结构：**
```json
{
  "port": 1,                    // 端口号
  "status": 1,                  // 状态码
  "status_desc": "充电中"       // 状态描述
}
```

## 充电相关字段

### 订单信息

| 字段名 | 数据类型 | 说明 | 格式/范围 | 示例值 |
|--------|----------|------|-----------|--------|
| order_id | string | 订单号 | 最长32字符 | "ORD20231221001" |
| order_number | string | 订单编号（同order_id） | 最长32字符 | "ORD20231221001" |
| card_number | string | 卡号 | 8位十六进制或数字 | "12345678" |

### 充电过程数据

| 字段名 | 数据类型 | 说明 | 单位/范围 | 示例值 |
|--------|----------|------|-----------|--------|
| start_time | string/integer | 开始时间 | 时间戳或格式化时间 | "2023-12-21 10:00:00" |
| end_time | string/integer | 结束时间 | 时间戳或格式化时间 | "2023-12-21 11:00:00" |
| charge_duration | integer | 充电时长 | 秒 | 3600 |
| total_energy | float | 总电量 | 度(kWh) | 15.50 |
| cumulative_energy | float | 累计电量 | 度(kWh) | 5.25 |

### 功率数据

| 字段名 | 数据类型 | 说明 | 单位/范围 | 示例值 |
|--------|----------|------|-----------|--------|
| current_power | float | 当前功率 | 瓦特(W) | 2200.5 |
| instant_power | float | 瞬时功率 | 瓦特(W) | 2200.5 |
| max_power | float | 最大功率 | 瓦特(W) | 2500.0 |
| min_power | float | 最小功率 | 瓦特(W) | 1800.0 |
| avg_power | float | 平均功率 | 瓦特(W) | 2100.0 |
| current | float | 电流 | 安培(A) | 10.2 |
| power_factor | float | 功率因数 | 0.0-1.0 | 0.95 |
| frequency | float | 频率 | 赫兹(Hz) | 50.0 |

### 充电状态

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| charging_status | integer | 充电状态码 | 0-255 | 1 |
| charging_status_desc | string | 充电状态描述 | 见充电状态枚举 | "正常充电" |
| charging_duration | integer | 充电持续时间 | 秒 | 1800 |

### 停止原因

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| stop_reason | integer | 停止原因码 | 0-255 | 1 |
| stop_reason_desc | string | 停止原因描述 | 见停止原因枚举 | "手动停止" |

## 结算相关字段

### 费用信息

| 字段名 | 数据类型 | 说明 | 单位/范围 | 示例值 |
|--------|----------|------|-----------|--------|
| total_fee | integer | 总费用 | 分(1元=100分) | 1550 |
| charge_fee | integer | 充电费用 | 分 | 1400 |
| service_fee | integer | 服务费 | 分 | 150 |
| total_fee_yuan | float | 总费用（元） | 元 | 15.50 |

### 结算信息

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| settlement_id | string | 结算ID | 最长64字符 | "SETTLE_04A228CD_1703123456" |
| settlement_type | string | 结算类型 | 见结算类型枚举 | "normal" |
| settlement_triggered | boolean | 是否由结算触发 | true/false | true |
| upload_time | integer | 上传时间戳 | Unix时间戳 | 1703123456 |

### 分时收费字段

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| rate_type | integer | 费率类型 | 0-255 | 1 |
| rate_type_desc | string | 费率类型描述 | 见费率类型枚举 | "峰时" |
| time_period_fee | integer | 分时段费用 | 分 | 800 |
| time_period_fee_yuan | float | 分时段费用（元） | 元 | 8.00 |

## 错误和失败相关字段

### 响应码

| 字段名 | 数据类型 | 说明 | 取值范围 | 示例值 |
|--------|----------|------|----------|--------|
| response_code | integer | 响应码 | 0-255 | 0 |
| status_desc | string | 状态描述 | 文本 | "充电开始成功" |
| error_code | integer | 错误码 | 0-255 | 1 |
| failure_reason | string | 失败原因 | 文本 | "端口故障" |
| failed_time | integer | 失败时间戳 | Unix时间戳 | 1703123456 |

## 枚举值定义

### 事件类型枚举 (event_type)

| 值 | 说明 | 触发时机 |
|----|------|----------|
| device_online | 设备上线 | TCP连接建立并注册成功 |
| device_offline | 设备离线 | 连接断开或心跳超时 |
| device_register | 设备注册 | 收到0x20注册指令 |
| device_heartbeat | 设备心跳 | 收到0x01/0x21心跳指令 |
| port_heartbeat | 端口心跳 | 端口状态变化 |
| charging_start | 充电开始 | 充电控制指令成功响应（开始） |
| charging_end | 充电结束 | 充电控制指令成功响应（结束）或结算 |
| charging_failed | 充电失败 | 充电控制指令失败响应 |
| power_heartbeat | 功率心跳 | 收到0x06/0x26功率指令 |
| charging_power | 充电功率 | 充电过程中的实时功率数据 |
| settlement | 结算 | 收到0x03/0x23结算指令 |

### 端口状态枚举 (port_status)

| 状态码 | 状态描述 | 是否充电 | 说明 |
|--------|----------|----------|------|
| 0x00 | 空闲 | 否 | 端口空闲，可以开始充电 |
| 0x01 | 充电中 | 是 | 正在充电 |
| 0x02 | 有充电器但未充电(未启动) | 否 | 充电器已插入但未开始充电 |
| 0x03 | 有充电器但未充电(已充满) | 否 | 充电完成 |
| 0x04 | 该路无法计量 | 否 | 计量模块故障 |
| 0x05 | 浮充 | 是 | 维持充电状态 |
| 0x06 | 存储器损坏 | 否 | 存储器故障 |
| 0x07 | 插座弹片卡住故障 | 否 | 机械故障 |
| 0x08 | 接触不良或保险丝烧断故障 | 否 | 电气故障 |
| 0x09 | 继电器粘连 | 否 | 继电器故障 |
| 0x0A | 霍尔开关损坏 | 否 | 传感器故障 |
| 0x0B | 继电器坏或保险丝断 | 否 | 电气故障 |
| 0x0C | 负载短路 | 否 | 短路故障 |
| 0x0D | 继电器粘连(预检) | 否 | 预检测到继电器故障 |
| 0x0E | 刷卡芯片损坏故障 | 否 | 刷卡模块故障 |
| 0x0F | 检测电路故障 | 否 | 检测电路故障 |

### 离线原因枚举 (offline_reason)

| 值 | 说明 |
|----|------|
| connection_lost | 网络连接断开 |
| heartbeat_timeout | 心跳超时 |
| manual_disconnect | 手动断开连接 |
| system_shutdown | 系统关闭 |

### 充电状态枚举 (charging_status)

| 状态码 | 状态描述 | 说明 |
|--------|----------|------|
| 0 | 未充电 | 设备未在充电状态 |
| 1 | 正常充电 | 设备正常充电中 |
| 2 | 充电异常 | 充电过程中出现异常 |
| 3 | 充电完成 | 充电已完成 |

### 停止原因枚举 (stop_reason)

| 原因码 | 原因描述 | 说明 |
|--------|----------|------|
| 0 | 未知原因 | 停止原因不明 |
| 1 | 手动停止 | 用户主动停止充电 |
| 2 | 充满停止 | 电池充满自动停止 |
| 3 | 故障停止 | 设备故障导致停止 |
| 4 | 超时停止 | 充电超时自动停止 |
| 5 | 余额不足 | 账户余额不足停止 |

### 结算类型枚举 (settlement_type)

| 值 | 说明 |
|----|------|
| normal | 普通结算 |
| time_billing | 分时收费结算 |
| emergency | 紧急结算 |

### 费率类型枚举 (rate_type)

| 类型码 | 类型描述 | 说明 |
|--------|----------|------|
| 0 | 平时 | 普通时段费率 |
| 1 | 峰时 | 用电高峰时段费率 |
| 2 | 谷时 | 用电低谷时段费率 |
| 3 | 尖峰时 | 用电尖峰时段费率 |

### 响应码枚举 (response_code)

| 响应码 | 说明 |
|--------|------|
| 0x00 | 成功 |
| 0x01 | 一般错误 |
| 0x02 | 参数错误 |
| 0x03 | 设备忙 |
| 0x04 | 设备故障 |
| 0x05 | 权限不足 |
| 0x06 | 超时 |
| 0x07 | 端口故障 |

## 数据格式转换说明

### 原始数据到标准格式的转换

1. **功率数据转换**
   - 原始值单位：0.1W
   - 转换公式：标准值(W) = 原始值 × 0.1
   - 示例：原始值22005 → 标准值2200.5W

2. **电压数据转换**
   - 原始值单位：0.1V
   - 转换公式：标准值(V) = 原始值 × 0.1
   - 示例：原始值2205 → 标准值220.5V

3. **电量数据转换**
   - 原始值单位：0.01度
   - 转换公式：标准值(kWh) = 原始值 × 0.01
   - 示例：原始值1550 → 标准值15.50度

4. **温度数据转换**
   - 原始值：带偏移的温度值
   - 转换公式：标准值(℃) = 原始值 - 65
   - 示例：原始值90 → 标准值25℃
   - 特殊值：0表示无温度传感器

5. **设备ID转换**
   - 原始格式：4字节小端序二进制
   - 转换步骤：小端转大端 → 十六进制字符串 → 大写
   - 示例：[0xCD, 0x28, 0xA2, 0x04] → "04A228CD"

这份数据字典为第三方平台开发人员提供了完整的字段定义和数据格式说明，确保数据对接的准确性和一致性。
